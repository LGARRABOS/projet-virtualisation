{
  "version": 4,
  "terraform_version": "1.5.7",
  "serial": 77,
  "lineage": "cb41bb8d-efda-9672-76d5-c69ef2ddc47f",
  "outputs": {},
  "resources": [
    {
      "mode": "data",
      "type": "xenorchestra_hosts",
      "name": "hosts",
      "provider": "provider[\"registry.terraform.io/terra-farm/xenorchestra\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "hosts": [
              {
                "cpus": {
                  "cores": 48,
                  "sockets": 2
                },
                "id": "d723d6c1-202c-4929-a012-181542233b28",
                "memory": 343597383680,
                "memory_usage": 64621162496,
                "name_label": "xcp-ngDL360",
                "pool_id": "838d0c46-b7a9-85e4-0c71-3c3a3f57dd84",
                "tags": []
              },
              {
                "cpus": {
                  "cores": 96,
                  "sockets": 2
                },
                "id": "4a1c75cb-bd50-4c18-96e5-abbe41953011",
                "memory": 171798691840,
                "memory_usage": 165825531904,
                "name_label": "xcp-dl380-gen10",
                "pool_id": "838d0c46-b7a9-85e4-0c71-3c3a3f57dd84",
                "tags": []
              }
            ],
            "id": "4a1c75cb-bd50-4c18-96e5-abbe41953011",
            "master": "4a1c75cb-bd50-4c18-96e5-abbe41953011",
            "pool_id": "838d0c46-b7a9-85e4-0c71-3c3a3f57dd84",
            "sort_by": null,
            "sort_order": null,
            "tags": null
          },
          "sensitive_attributes": []
        }
      ]
    },
    {
      "mode": "managed",
      "type": "random_id",
      "name": "mac_mon",
      "provider": "provider[\"registry.terraform.io/hashicorp/random\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "b64_std": "XtkmKJQ=",
            "b64_url": "XtkmKJQ",
            "byte_length": 5,
            "dec": "407370082452",
            "hex": "5ed9262894",
            "id": "XtkmKJQ",
            "keepers": null,
            "prefix": null
          },
          "sensitive_attributes": []
        }
      ]
    },
    {
      "mode": "managed",
      "type": "random_id",
      "name": "mac_rp",
      "provider": "provider[\"registry.terraform.io/hashicorp/random\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "b64_std": "JIPtoyY=",
            "b64_url": "JIPtoyY",
            "byte_length": 5,
            "dec": "156832211750",
            "hex": "2483eda326",
            "id": "JIPtoyY",
            "keepers": null,
            "prefix": null
          },
          "sensitive_attributes": []
        }
      ]
    },
    {
      "mode": "managed",
      "type": "random_id",
      "name": "mac_wp",
      "provider": "provider[\"registry.terraform.io/hashicorp/random\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "b64_std": "11XfH9c=",
            "b64_url": "11XfH9c",
            "byte_length": 5,
            "dec": "924858654679",
            "hex": "d755df1fd7",
            "id": "11XfH9c",
            "keepers": null,
            "prefix": null
          },
          "sensitive_attributes": []
        }
      ]
    },
    {
      "mode": "managed",
      "type": "xenorchestra_vm",
      "name": "monitoring",
      "provider": "provider[\"registry.terraform.io/terra-farm/xenorchestra\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "affinity_host": "d723d6c1-202c-4929-a012-181542233b28",
            "auto_poweron": false,
            "blocked_operations": null,
            "cdrom": [],
            "cloud_config": "#cloud-config\nhostname: srv-monit-01\nusers:\n  - name: admin-sys\n    sudo: ['ALL=(ALL) NOPASSWD:ALL']\n    groups: wheel\n    shell: /bin/bash\n    ssh_authorized_keys:\n      - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDL8fEzs9QTcGOAl62I/QF5wWy6bCvdhdEknxUuBHedE2PNgT5zhgIu0qZUDqHElLUF22SXrAwbDdQYUrLJNndYblBg1B4Pj4sakkxDne0X56YEuANcS6CNieyTZZcUW0d/iaNbinKACZbcFIFNa+GvDwPMcco2GIBiQenPlrcGBH3gLX/vlX3rTH0fvoAo2B1PMvxhls8XADCUOFEU5HTKPMDdsX5wxgmqT7Ukbmz9rFUfCvyPUoDESaBi3y8UhWmZH1VeSsYyF8l9IGngLvUnyQKzSqnH0ysgwTIfmz/5ARW8DCAdPeCMkqvu7qQCd0JjBPhLjeF713GFNanR81bG2r+jecThlIC5pt6WZTxtqSyPtAguhcwmYNfj5gGbkqtiT/R6zcTIqoW1N6KrwQCRuDZkDDB0ILpyDPh8E/VJBTAccLDlJ0V69jUUnpgTwgSijW/wXuGxzH5riN2TjTBqR8Aci7jAWdy3hAVs7Rb3rhwVyWhXw1//uTxm4DUDDRM= dreasy@Maxou-9.local\n\nwrite_files:\n  - path: /etc/NetworkManager/system-connections/enX0.nmconnection\n    permissions: '0600'\n    content: |\n      [connection]\n      id=enX0\n      type=ethernet\n      interface-name=enX0\n      \n      [ipv4]\n      method=manual\n      address1=10.200.0.199/24,10.200.0.254\n      dns=1.1.1.1;\n      \n      [ipv6]\n      method=ignore\n  \n  # 1. Netdata (Monitoring)\n  - path: /opt/netdata/docker-compose.yml\n    content: |\n      version: '3'\n      services:\n        netdata:\n          image: netdata/netdata\n          container_name: netdata\n          hostname: srv-monit-01\n          ports:\n            - 19999:19999\n          restart: unless-stopped\n          cap_add:\n            - SYS_PTRACE\n          security_opt:\n            - apparmor:unconfined\n          volumes:\n            - netdatalib:/var/lib/netdata\n            - netdatacache:/var/cache/netdata\n            - /etc/passwd:/host/etc/passwd:ro\n            - /etc/group:/host/etc/group:ro\n            - /proc:/host/proc:ro\n            - /sys:/host/sys:ro\n            - /etc/os-release:/host/etc/os-release:ro\n      volumes:\n        netdatalib:\n        netdatacache:\n\n  # 2. Patchmon (Gestion Patchs)\n  - path: /opt/patchmon/docker-compose.yml\n    content: |\n      name: patchmon\n\n      services:\n        database:\n          image: postgres:17-alpine\n          restart: unless-stopped\n          environment:\n            POSTGRES_DB: patchmon_db\n            POSTGRES_USER: patchmon_user\n            POSTGRES_PASSWORD: StrongDBPassword123! # Mot de passe DB\n          volumes:\n            - postgres_data:/var/lib/postgresql/data\n          networks:\n            - patchmon-internal\n          healthcheck:\n            test: [\"CMD-SHELL\", \"pg_isready -U patchmon_user -d patchmon_db\"]\n            interval: 3s\n            timeout: 5s\n            retries: 7\n\n        redis:\n          image: redis:7-alpine\n          restart: unless-stopped\n          command: redis-server --requirepass StrongRedisPassword456! # Mot de passe Redis\n          volumes:\n            - redis_data:/data\n          networks:\n            - patchmon-internal\n          healthcheck:\n            test: [\"CMD\", \"redis-cli\", \"--no-auth-warning\", \"-a\", \"StrongRedisPassword456!\", \"ping\"]\n            interval: 3s\n            timeout: 5s\n            retries: 7\n\n        backend:\n          image: ghcr.io/patchmon/patchmon-backend:latest\n          restart: unless-stopped\n          environment:\n            LOG_LEVEL: info\n            DATABASE_URL: postgresql://patchmon_user:StrongDBPassword123!@database:5432/patchmon_db\n            JWT_SECRET: 7f8e9d1c2b3a4f5e6d7c8b9a0f1e2d3c4b5a6f7e8d9c0b1a2f3e4d5c6b7a8f9 # Secret JWT généré\n            SERVER_PROTOCOL: http\n            SERVER_HOST: 10.200.0.199 # IP de la VM Monitoring\n            SERVER_PORT: 3000\n            CORS_ORIGIN: http://10.200.0.199:3000\n            # Database Connection Pool\n            DB_CONNECTION_LIMIT: 30\n            DB_POOL_TIMEOUT: 20\n            DB_CONNECT_TIMEOUT: 10\n            DB_IDLE_TIMEOUT: 300\n            DB_MAX_LIFETIME: 1800\n            # Rate Limiting\n            RATE_LIMIT_WINDOW_MS: 900000\n            RATE_LIMIT_MAX: 5000\n            AUTH_RATE_LIMIT_WINDOW_MS: 600000\n            AUTH_RATE_LIMIT_MAX: 500\n            AGENT_RATE_LIMIT_WINDOW_MS: 60000\n            AGENT_RATE_LIMIT_MAX: 1000\n            # Redis Configuration\n            REDIS_HOST: redis\n            REDIS_PORT: 6379\n            REDIS_PASSWORD: StrongRedisPassword456!\n            REDIS_DB: 0\n            ASSETS_DIR: /app/assets\n          volumes:\n            - agent_files:/app/agents\n            - branding_assets:/app/assets\n          networks:\n            - patchmon-internal\n          depends_on:\n            database:\n              condition: service_healthy\n            redis:\n              condition: service_healthy\n\n        frontend:\n          image: ghcr.io/patchmon/patchmon-frontend:latest\n          restart: unless-stopped\n          ports:\n            - \"3000:3000\"\n          volumes:\n            - branding_assets:/usr/share/nginx/html/assets\n          networks:\n            - patchmon-internal\n          depends_on:\n            backend:\n              condition: service_healthy\n\n      volumes:\n        postgres_data:\n        redis_data:\n        agent_files:\n        branding_assets:\n\n      networks:\n        patchmon-internal:\n          driver: bridge\n\nruncmd:\n  # Disable SELinux\n  - setenforce 0\n  - sed -i 's/^SELINUX=.*/SELINUX=disabled/g' /etc/selinux/config\n  # Config Réseau\n  - chmod 600 /etc/NetworkManager/system-connections/enX0.nmconnection\n  - nmcli c reload\n  - nmcli c up enX0\n  \n  # Install Docker\n  - dnf config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo\n  - dnf install -y docker-ce docker-ce-cli containerd.io docker-compose-plugin\n  - systemctl enable --now docker\n  \n  # Lancement Netdata\n  - cd /opt/netdata \u0026\u0026 docker compose up -d\n  \n  # Lancement Patchmon\n  - cd /opt/patchmon \u0026\u0026 docker compose up -d\n",
            "cloud_network_config": null,
            "core_os": false,
            "cpu_cap": 0,
            "cpu_weight": 0,
            "cpus": 4,
            "disk": [
              {
                "attached": true,
                "name_description": "",
                "name_label": "Rocky Linuaqwf",
                "position": "0",
                "size": 32212254720,
                "sr_id": "2d27fd89-3cdf-e345-4cbe-0476d65d48a1",
                "vbd_id": "96a87aa6-b1d9-6f38-47de-79f655806765",
                "vdi_id": "eada7f2b-ccfe-4a9a-b842-84d242bf444a"
              }
            ],
            "exp_nested_hvm": false,
            "high_availability": "",
            "host": null,
            "hvm_boot_firmware": "uefi",
            "id": "5d2e3db3-0220-868d-281f-6b3499febc3a",
            "installation_method": null,
            "ipv4_addresses": [],
            "ipv6_addresses": [],
            "memory_max": 4294967296,
            "name_description": "Netdata \u0026 Patchmon - 10.200.0.199",
            "name_label": "SRV-MONIT-01",
            "network": [
              {
                "attached": true,
                "device": "0",
                "ipv4_addresses": [],
                "ipv6_addresses": [],
                "mac_address": "02:00:00:00:00:03",
                "network_id": "82602d24-efdd-d5f0-f983-1a2d867907bb"
              }
            ],
            "power_state": "Running",
            "resource_set": "",
            "start_delay": 0,
            "tags": null,
            "template": "a00108b8-aac6-5f74-fe01-b25760ff2034",
            "timeouts": null,
            "vga": "std",
            "videoram": 8,
            "wait_for_ip": false
          },
          "sensitive_attributes": [],
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjozMDAwMDAwMDAwMDAsImRlbGV0ZSI6MzAwMDAwMDAwMDAwLCJ1cGRhdGUiOjMwMDAwMDAwMDAwMH19",
          "dependencies": [
            "data.xenorchestra_hosts.hosts"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "xenorchestra_vm",
      "name": "reverse_proxy",
      "provider": "provider[\"registry.terraform.io/terra-farm/xenorchestra\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "affinity_host": "d723d6c1-202c-4929-a012-181542233b28",
            "auto_poweron": false,
            "blocked_operations": [],
            "cdrom": [],
            "cloud_config": "#cloud-config\nhostname: srv-rp-nginx-01\nusers:\n  - name: admin-sys\n    sudo: ['ALL=(ALL) NOPASSWD:ALL']\n    groups: wheel\n    shell: /bin/bash\n    ssh_authorized_keys:\n      - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDL8fEzs9QTcGOAl62I/QF5wWy6bCvdhdEknxUuBHedE2PNgT5zhgIu0qZUDqHElLUF22SXrAwbDdQYUrLJNndYblBg1B4Pj4sakkxDne0X56YEuANcS6CNieyTZZcUW0d/iaNbinKACZbcFIFNa+GvDwPMcco2GIBiQenPlrcGBH3gLX/vlX3rTH0fvoAo2B1PMvxhls8XADCUOFEU5HTKPMDdsX5wxgmqT7Ukbmz9rFUfCvyPUoDESaBi3y8UhWmZH1VeSsYyF8l9IGngLvUnyQKzSqnH0ysgwTIfmz/5ARW8DCAdPeCMkqvu7qQCd0JjBPhLjeF713GFNanR81bG2r+jecThlIC5pt6WZTxtqSyPtAguhcwmYNfj5gGbkqtiT/R6zcTIqoW1N6KrwQCRuDZkDDB0ILpyDPh8E/VJBTAccLDlJ0V69jUUnpgTwgSijW/wXuGxzH5riN2TjTBqR8Aci7jAWdy3hAVs7Rb3rhwVyWhXw1//uTxm4DUDDRM= dreasy@Maxou-9.local\n\n# Config Réseau Statique (Rocky 9 utilise NetworkManager)\nwrite_files:\n  - path: /etc/NetworkManager/system-connections/enX0.nmconnection\n    permissions: '0600'\n    content: |\n      [connection]\n      id=enX0\n      type=ethernet\n      interface-name=enX0\n      \n      [ipv4]\n      method=manual\n      address1=10.199.0.200/24,10.199.0.254\n      dns=1.1.1.1;8.8.8.8\n      \n      [ipv6]\n      method=ignore\n\npackage_update: true\npackages:\n  - nginx\n  - git\n\nruncmd:\n  # Disable SELinux\n  - setenforce 0\n  - sed -i 's/^SELINUX=.*/SELINUX=disabled/g' /etc/selinux/config\n  - firewall-cmd --permanent --add-port=80/tcp\n  - firewall-cmd --permanent --add-port=80/udp\n  - firewall-cmd --reload\n  - chmod 600 /etc/NetworkManager/system-connections/enX0.nmconnection\n  - nmcli c reload\n  - nmcli c up enX0\n  - systemctl enable --now nginx\n  # Config simple reverse proxy (exemple)\n  - echo 'server { listen 80; server_name cours.hostaria.cloud; location / { proxy_pass http://10.200.0.200:80; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; } }' \u003e /etc/nginx/conf.d/reverse.conf\n  - systemctl restart nginx\n",
            "cloud_network_config": null,
            "core_os": false,
            "cpu_cap": 0,
            "cpu_weight": 0,
            "cpus": 4,
            "disk": [
              {
                "attached": true,
                "name_description": "",
                "name_label": "Rocky Linuaqwf",
                "position": "0",
                "size": 32212254720,
                "sr_id": "2d27fd89-3cdf-e345-4cbe-0476d65d48a1",
                "vbd_id": "e5bddc90-de1f-d592-7a66-3de62e87b58a",
                "vdi_id": "e7773d42-4661-4421-940b-5eb0db919330"
              }
            ],
            "exp_nested_hvm": false,
            "high_availability": "",
            "host": null,
            "hvm_boot_firmware": "uefi",
            "id": "d9784641-b988-57dd-c8a7-8b1767a4c6ab",
            "installation_method": null,
            "ipv4_addresses": [],
            "ipv6_addresses": [],
            "memory_max": 4294967296,
            "name_description": "Reverse Proxy Nginx - 10.199.0.200",
            "name_label": "SRV-RP-NGINX-01",
            "network": [
              {
                "attached": true,
                "device": "0",
                "ipv4_addresses": [],
                "ipv6_addresses": [],
                "mac_address": "02:00:00:00:00:01",
                "network_id": "652c5523-c28a-f1a9-f739-f360b7881730"
              }
            ],
            "power_state": "Running",
            "resource_set": "",
            "start_delay": 0,
            "tags": [],
            "template": "a00108b8-aac6-5f74-fe01-b25760ff2034",
            "timeouts": null,
            "vga": "std",
            "videoram": 8,
            "wait_for_ip": false
          },
          "sensitive_attributes": [],
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjozMDAwMDAwMDAwMDAsImRlbGV0ZSI6MzAwMDAwMDAwMDAwLCJ1cGRhdGUiOjMwMDAwMDAwMDAwMH19",
          "dependencies": [
            "data.xenorchestra_hosts.hosts"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "xenorchestra_vm",
      "name": "wordpress_app",
      "provider": "provider[\"registry.terraform.io/terra-farm/xenorchestra\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "affinity_host": "d723d6c1-202c-4929-a012-181542233b28",
            "auto_poweron": false,
            "blocked_operations": [],
            "cdrom": [],
            "cloud_config": "#cloud-config\nhostname: srv-app-wp-01\nusers:\n  - name: admin-sys\n    sudo: ['ALL=(ALL) NOPASSWD:ALL']\n    groups: wheel\n    shell: /bin/bash\n    ssh_authorized_keys:\n      - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDL8fEzs9QTcGOAl62I/QF5wWy6bCvdhdEknxUuBHedE2PNgT5zhgIu0qZUDqHElLUF22SXrAwbDdQYUrLJNndYblBg1B4Pj4sakkxDne0X56YEuANcS6CNieyTZZcUW0d/iaNbinKACZbcFIFNa+GvDwPMcco2GIBiQenPlrcGBH3gLX/vlX3rTH0fvoAo2B1PMvxhls8XADCUOFEU5HTKPMDdsX5wxgmqT7Ukbmz9rFUfCvyPUoDESaBi3y8UhWmZH1VeSsYyF8l9IGngLvUnyQKzSqnH0ysgwTIfmz/5ARW8DCAdPeCMkqvu7qQCd0JjBPhLjeF713GFNanR81bG2r+jecThlIC5pt6WZTxtqSyPtAguhcwmYNfj5gGbkqtiT/R6zcTIqoW1N6KrwQCRuDZkDDB0ILpyDPh8E/VJBTAccLDlJ0V69jUUnpgTwgSijW/wXuGxzH5riN2TjTBqR8Aci7jAWdy3hAVs7Rb3rhwVyWhXw1//uTxm4DUDDRM= dreasy@Maxou-9.local\n\nwrite_files:\n  - path: /etc/NetworkManager/system-connections/enX0.nmconnection\n    permissions: '0600'\n    content: |\n      [connection]\n      id=enX0\n      type=ethernet\n      interface-name=enX0\n      \n      [ipv4]\n      method=manual\n      address1=10.200.0.200/24,10.200.0.254\n      dns=1.1.1.1;\n      \n      [ipv6]\n      method=ignore\n\n  # Fichier Docker Compose WordPress\n  - path: /opt/wordpress/docker-compose.yml\n    content: |\n      version: '3'\n      services:\n        db:\n          image: mysql:5.7\n          volumes:\n            - db_data:/var/lib/mysql\n          restart: always\n          environment:\n            MYSQL_ROOT_PASSWORD: securepassroot\n            MYSQL_DATABASE: wordpress\n            MYSQL_USER: wordpress\n            MYSQL_PASSWORD: securepasswp\n        \n        wordpress:\n          depends_on:\n            - db\n          image: wordpress:latest\n          ports:\n            - \"80:80\"\n          restart: always\n        \n          environment:\n            WORDPRESS_DB_HOST: db:3306\n            WORDPRESS_DB_USER: wordpress\n            WORDPRESS_DB_PASSWORD: securepasswp\n            WORDPRESS_DB_NAME: wordpress\n      volumes:\n        db_data:\n\nruncmd:\n  # Disable SELinux\n  - setenforce 0\n  - sed -i 's/^SELINUX=.*/SELINUX=disabled/g' /etc/selinux/config\n  # Config Réseau\n  - chmod 600 /etc/NetworkManager/system-connections/enX0.nmconnection\n  - nmcli c reload\n  - nmcli c up enX0\n  \n  # Install Docker\n  - dnf config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo\n  - dnf install -y docker-ce docker-ce-cli containerd.io docker-compose-plugin\n  - systemctl enable --now docker\n  \n  # Lancement App\n  - cd /opt/wordpress \u0026\u0026 docker compose up -d\n",
            "cloud_network_config": null,
            "core_os": false,
            "cpu_cap": 0,
            "cpu_weight": 0,
            "cpus": 4,
            "disk": [
              {
                "attached": true,
                "name_description": "",
                "name_label": "Rocky Linuaqwf",
                "position": "0",
                "size": 32212254720,
                "sr_id": "2d27fd89-3cdf-e345-4cbe-0476d65d48a1",
                "vbd_id": "f60b5074-7439-0c3a-52b4-40d13283a25f",
                "vdi_id": "3ac8aada-62d9-446d-aefe-5c45bb03e28d"
              }
            ],
            "exp_nested_hvm": false,
            "high_availability": "",
            "host": null,
            "hvm_boot_firmware": "uefi",
            "id": "8cb30946-5811-5c44-ba48-4b90e9ad0fa4",
            "installation_method": null,
            "ipv4_addresses": [],
            "ipv6_addresses": [],
            "memory_max": 8589934592,
            "name_description": "WordPress Docker - 10.100.0.200",
            "name_label": "SRV-APP-WP-01",
            "network": [
              {
                "attached": true,
                "device": "0",
                "ipv4_addresses": [],
                "ipv6_addresses": [],
                "mac_address": "02:00:00:00:00:02",
                "network_id": "82602d24-efdd-d5f0-f983-1a2d867907bb"
              }
            ],
            "power_state": "Running",
            "resource_set": "",
            "start_delay": 0,
            "tags": [],
            "template": "a00108b8-aac6-5f74-fe01-b25760ff2034",
            "timeouts": null,
            "vga": "std",
            "videoram": 8,
            "wait_for_ip": false
          },
          "sensitive_attributes": [],
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjozMDAwMDAwMDAwMDAsImRlbGV0ZSI6MzAwMDAwMDAwMDAwLCJ1cGRhdGUiOjMwMDAwMDAwMDAwMH19",
          "dependencies": [
            "data.xenorchestra_hosts.hosts"
          ]
        }
      ]
    }
  ],
  "check_results": null
}
